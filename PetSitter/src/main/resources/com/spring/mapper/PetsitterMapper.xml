<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	 
<mapper namespace = "com.spring.mapper.PetsitterMapper">
	
	<select id="petsitterCheck" parameterType = "PetsitterVO" resultType = "int">
		select count(*) from petsitter where PETSITTER_ID = #{PETSITTER_ID} and PETSITTER_PW = #{PETSITTER_PW}
	</select>
	
	<select id="petsitterList" resultType="PetsitterVO">
		select * from petsitter order by PETSITTER_DATE
	</select>
	
	<!-- 신규 추천 펫시터 -->
	<select id="petsitterList_date" resultType="PetsitterVO">
		<![CDATA[
		select * from (select petsitter.*, rownum from petsitter order by petsitter_date desc) where rownum <= 3
		]]>
	</select>
	
	<select id="petsitter_thisMonth" resultType="PetsitterVO">
		<![CDATA[
		select * from (select petsitter.*, rownum 
               from petsitter 
               where petsitter_date >= trunc(add_months(sysdate, -1)) and petsitter_score != 0 and petsitter_count != 0
               order by petsitter_score desc, petsitter_count desc)
		where rownum = 1
		]]>
	</select>
	
	<select id="petsitter_thisMonth_score" resultType="PetsitterVO">
		<![CDATA[
		select * from (select petsitter.*, rownum
									 from petsitter
									 where petsitter_date >= trunc(add_months(sysdate, -1)) and petsitter_score != 0 and petsitter_count != 0
									 order by petsitter_score desc)
		where rownum = 1
		]]>
	</select>
	
	<select id="petsitter_thisMonth_count" resultType="PetsitterVO">
		<![CDATA[
		select * from (select petsitter.*, rownum
									 from petsitter
									 where petsitter_date >= trunc(add_months(sysdate, -1)) and petsitter_score != 0 and petsitter_count != 0
									 order by petsitter_count desc)
		where rownum = 1
		]]>
	</select>
	
	<select id = "petsitterNicknameCheck" parameterType = "PetsitterVO" resultType="int">
		select count(*) from petsitter where PETSITTER_NICKNAME = #{PETSITTER_NICKNAME}
	</select>
	
	<select id="selectPetsitter" parameterType="String" resultType="PetsitterVO">
		select * from petsitter where PETSITTER_ID = #{PETSITTER_ID}
	</select>
	
	<insert id = "petsitterSchedule" parameterType = "PetsitterScheduleVO">
		insert into petsitter_schedule (PETSITTER_ID,START_DATE,END_DATE) 
		values(#{PETSITTER_ID},#{START_DATE},#{END_DATE})
	</insert>
	
	<insert id ="insertPetsitter" parameterType = "PetsitterVO">
		insert into petsitter (PETSITTER_ID,PETSITTER_PW,PETSITTER_NAME,PETSITTER_TEL,PETSITTER_EMAIL,
		PETSITTER_ADDRESS,PETSITTER_INTRODUCE,
		PETSITTER_PRICE_30M,PETSITTER_PRICE_60M,PETSITTER_SERVICE_LIST,PETSITTER_PHOTO_UPFILE,
		PETSITTER_PHOTO_PROFILE_FILE,PETSITTER_CERT_LIST,PETSITTER_PHOTO_CERT_FILE,
		PETSITTER_PHOTO_HOME_FILE,PETSITTER_TYPE,PETSITTER_ADDRX,PETSITTER_ADDRY) values 
		(#{PETSITTER_ID},#{PETSITTER_PW},#{PETSITTER_NAME},#{PETSITTER_TEL},#{PETSITTER_EMAIL}
		,#{PETSITTER_ADDRESS},#{PETSITTER_INTRODUCE}
		,#{PETSITTER_PRICE_30M},#{PETSITTER_PRICE_60M},#{PETSITTER_SERVICE_LIST},#{PETSITTER_PHOTO_UPFILE}
		,#{PETSITTER_PHOTO_PROFILE_FILE},#{PETSITTER_CERT_LIST},#{PETSITTER_PHOTO_CERT_FILE},#{PETSITTER_PHOTO_HOME_FILE}
		,#{PETSITTER_TYPE},#{PETSITTER_ADDRX},#{PETSITTER_ADDRY})
	</insert>
	
	<update id = "petsitterUpdate" parameterType = "PetsitterVO">
		update petsitter set PETSITTER_NICKNAME = #{PETSITTER_NICKNAME},PETSITTER_PW=#{PETSITTER_PW},PETSITTER_GENDER=#{PETSITTER_GENDER},PETSITTER_TEL=#{PETSITTER_TEL},
		PETSITTER_EMAIL=#{PETSITTER_EMAIL},PETSITTER_ADDRESS=#{PETSITTER_ADDRESS},PETSITTER_INTRODUCE=#{PETSITTER_INTRODUCE},
		PETSITTER_PRICE_30M=#{PETSITTER_PRICE_30M},PETSITTER_PRICE_60M=#{PETSITTER_PRICE_60M},PETSITTER_SERVICE_LIST=#{PETSITTER_SERVICE_LIST},
		PETSITTER_PHOTO_UPFILE=#{PETSITTER_PHOTO_UPFILE},PETSITTER_PHOTO_PROFILE_FILE=#{PETSITTER_PHOTO_PROFILE_FILE},
		PETSITTER_CERT_LIST=#{PETSITTER_CERT_LIST},PETSITTER_PHOTO_CERT_FILE=#{PETSITTER_PHOTO_CERT_FILE},PETSITTER_PHOTO_HOME_FILE=#{PETSITTER_PHOTO_HOME_FILE},
		PETSITTER_TYPE=#{PETSITTER_TYPE},PETSITTER_PHOTO_APPEAL=#{PETSITTER_PHOTO_APPEAL},PETSITTER_ADDRX=#{PETSITTER_ADDRX},PETSITTER_ADDRY=#{PETSITTER_ADDRY},
		PETSITTER_SAFEADDR=#{PETSITTER_SAFEADDR} where PETSITTER_ID=#{PETSITTER_ID}
	</update>
	
	<update id = "reflyUpdate" parameterType = "ReviewBoardVO">
		update review_board set review_refly = #{REVIEW_REFLY} where petsitter_id = #{PETSITTER_ID} and usinglist_num = #{USINGLIST_NUM}
	</update>
	
	<update id = "petsitterApproval" parameterType = "PetsitterVO">
		update petsitter set PETSITTER_RANK = 'Pro' where PETSITTER_ID = #{PETSITTER_ID}
	</update>
	
	<update id="petsitterRefusal" parameterType="PetsitterVO">
		update petsitter set PETSITTER_RANK = 'X' where PETSITTER_ID = #{PETSITTER_ID}
	</update>
	
	<update id="petsitterscoreupdate" parameterType="map">
		update petsitter set PETSITTER_SCORE=#{PETSITTER_SCORE}, PETSITTER_REVIEWCOUNT=PETSITTER_REVIEWCOUNT+1 where PETSITTER_ID=#{PETSITTER_ID}
	</update>
</mapper>